# –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "–ö–∞—Ä—Ç–∞ –∫–∞–Ω–∞–ª–∞" —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

## üìÅ –§–∞–π–ª—ã

### telegram-bot.py

–ü—Ä–æ—Å—Ç–æ–π Telegram –±–æ—Ç –Ω–∞ Python –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Web App.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ö–æ–º–∞–Ω–¥–∞ `/start` —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞—Ä—Ç—ã
- –ö–æ–º–∞–Ω–¥–∞ `/help` —Å–æ —Å–ø—Ä–∞–≤–∫–æ–π
- –ö–æ–º–∞–Ω–¥–∞ `/map` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install python-telegram-bot==20.7

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª
# –£–∫–∞–∂–∏—Ç–µ TOKEN –∏ WEB_APP_URL

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
python telegram-bot.py
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ –≤ [@BotFather](https://t.me/botfather):
   ```
   /newbot
   ```

2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω

3. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Vercel, Netlify, etc.)

4. –£–∫–∞–∂–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ URL –≤ –∫–æ–¥–µ:
   ```python
   TOKEN = "123456:ABC-DEF..."
   WEB_APP_URL = "https://your-app.vercel.app"
   ```

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

## üéØ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. Menu Button (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± - –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É Web App –≤ –º–µ–Ω—é –±–æ—Ç–∞:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/botfather)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. Bot Settings ‚Üí Menu Button
4. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ –≤ —á–∞—Ç–µ —Å –±–æ—Ç–æ–º.

### 2. Inline –∫–Ω–æ–ø–∫–∞ –≤ –∫–∞–Ω–∞–ª–µ

–î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –≤ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞:

```python
from telegram import InlineKeyboardButton, InlineKeyboardMarkup, WebAppInfo

keyboard = [[
    InlineKeyboardButton(
        "üó∫Ô∏è –ö–∞—Ä—Ç–∞ –∫–∞–Ω–∞–ª–∞",
        web_app=WebAppInfo(url="https://your-app.vercel.app")
    )
]]
reply_markup = InlineKeyboardMarkup(keyboard)

await bot.send_message(
    chat_id="@your_channel",
    text="üìå –í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∫–∞–Ω–∞–ª–∞ –≤ —É–¥–æ–±–Ω–æ–π –∫–∞—Ä—Ç–µ:",
    reply_markup=reply_markup
)
```

### 3. –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞

–ü—Ä–æ—Å—Ç–æ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π:
```
https://your-app.vercel.app
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–º –±—Ä–∞—É–∑–µ—Ä–µ, –≤–∫–ª—é—á–∞—è Telegram in-app browser.

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram WebApp

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—à–µ–ª –∏–∑ Telegram, –º–æ–∂–Ω–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å `initData`:

```python
import hmac
import hashlib
from urllib.parse import parse_qs

def validate_telegram_webapp(init_data: str, bot_token: str) -> bool:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è initData –æ—Ç Telegram WebApp
    https://core.telegram.org/bots/webapps#validating-data-received-via-the-mini-app
    """
    try:
        parsed = parse_qs(init_data)
        hash_value = parsed.get('hash', [''])[0]
        
        # –£–¥–∞–ª—è–µ–º hash –∏–∑ –¥–∞–Ω–Ω—ã—Ö
        data_check_string = '\n'.join(
            f"{k}={v[0]}" 
            for k, v in sorted(parsed.items()) 
            if k != 'hash'
        )
        
        # –°–æ–∑–¥–∞–µ–º secret_key
        secret_key = hmac.new(
            "WebAppData".encode(),
            bot_token.encode(),
            hashlib.sha256
        ).digest()
        
        # –í—ã—á–∏—Å–ª—è–µ–º hash
        calculated_hash = hmac.new(
            secret_key,
            data_check_string.encode(),
            hashlib.sha256
        ).hexdigest()
        
        return calculated_hash == hash_value
    except:
        return False
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–í Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```typescript
// lib/telegram.ts

export function getTelegramUser() {
  if (typeof window === 'undefined' || !window.Telegram?.WebApp) {
    return null;
  }
  
  const user = window.Telegram.WebApp.initDataUnsafe?.user;
  
  return user ? {
    id: user.id,
    firstName: user.first_name,
    lastName: user.last_name,
    username: user.username,
    languageCode: user.language_code,
  } : null;
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –±–æ—Ç—É

–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è –∏–∑ Web App –±–æ—Ç—É:

```typescript
// –í Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
if (window.Telegram?.WebApp) {
  window.Telegram.WebApp.sendData(JSON.stringify({
    action: 'item_opened',
    itemId: 'example-id',
  }));
}
```

```python
# –í –±–æ—Ç–µ
from telegram.ext import MessageHandler, filters

async def web_app_data(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Web App"""
    data = json.loads(update.effective_message.web_app_data.data)
    
    if data.get('action') == 'item_opened':
        item_id = data.get('itemId')
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ —Ç.–¥.

application.add_handler(
    MessageHandler(filters.StatusUpdate.WEB_APP_DATA, web_app_data)
)
```

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ—Å—Ç—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤ –±–æ—Ç–∞:

```python
import json
from datetime import datetime

# –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Web App
stats = {
    'user_id': update.effective_user.id,
    'username': update.effective_user.username,
    'timestamp': datetime.now().isoformat(),
}

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª –∏–ª–∏ –ë–î
with open('stats.json', 'a') as f:
    f.write(json.dumps(stats) + '\n')
```

### Google Analytics / Yandex Metrika

–î–æ–±–∞–≤—å—Ç–µ —Å—á–µ—Ç—á–∏–∫ –≤ `app/layout.tsx`:

```tsx
<Script
  src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"
  strategy="afterInteractive"
/>
<Script id="google-analytics" strategy="afterInteractive">
  {`
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX');
  `}
</Script>
```

## üöÄ –î–µ–ø–ª–æ–π –±–æ—Ç–∞

### Docker

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY telegram-bot.py .

CMD ["python", "telegram-bot.py"]
```

### Railway / Heroku

1. –°–æ–∑–¥–∞–π—Ç–µ `requirements.txt`:
   ```
   python-telegram-bot==20.7
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ `Procfile`:
   ```
   worker: python telegram-bot.py
   ```

3. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –Ω–∞ Railway/Heroku

4. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - `BOT_TOKEN`
   - `WEB_APP_URL`

### systemd (Linux —Å–µ—Ä–≤–µ—Ä)

```ini
[Unit]
Description=Telegram Channel Map Bot
After=network.target

[Service]
Type=simple
User=bot
WorkingDirectory=/opt/telegram-bot
ExecStart=/usr/bin/python3 /opt/telegram-bot/telegram-bot.py
Restart=always

[Install]
WantedBy=multi-user.target
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Web App –ª–æ–∫–∞–ª—å–Ω–æ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Next.js
npm run dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ ngrok
ngrok http 3000

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS URL –æ—Ç ngrok –≤ –±–æ—Ç–µ
WEB_APP_URL = "https://xxxx-xx-xxx.ngrok.io"
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å:

```bash
python telegram-bot.py

# –í—ã–≤–æ–¥:
# 2025-12-17 12:00:00 - __main__ - INFO - üöÄ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!
# 2025-12-17 12:00:00 - __main__ - INFO - üì± Web App URL: https://...
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Telegram WebApps](https://core.telegram.org/bots/webapps)
- [python-telegram-bot –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.python-telegram-bot.org/)
- [Next.js –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://nextjs.org/docs)

## üí° –ò–¥–µ–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

1. **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - —Ä–∞—Å—Å—ã–ª–∫–∞ –æ –Ω–æ–≤—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–∏—Å–∫–∏
4. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
5. **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** - —Ä–∞–∑–Ω—ã–µ —è–∑—ã–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
6. **–≠–∫—Å–ø–æ—Ä—Ç** - —Å–∫–∞—á–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –≤ PDF/JSON
7. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** - –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
8. **–†–µ–π—Ç–∏–Ω–≥–∏** - –æ—Ü–µ–Ω–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

**–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏!

