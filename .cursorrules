# Cursor Rules для проекта "Карта канала"

## Стек технологий
- Next.js 14 (App Router)
- TypeScript
- Tailwind CSS
- React 18

## Ключевые правила

### 1. Источник данных
- **ЕДИНСТВЕННЫЙ источник контента**: `data/map.json`
- Не создавать базы данных
- Не использовать внешние API для контента
- Все изменения контента только через редактирование JSON

### 2. Стилизация
- Использовать только Tailwind CSS
- Никаких CSS модулей или styled-components
- Mobile-first подход
- Поддержка темной темы через `dark:` префикс

### 3. State Management
- Использовать localStorage для:
  - Избранное (favorites:v1)
  - Недавние (recent:v1)
- Не использовать глобальный state manager (Redux, Zustand и т.д.)
- Локальный state через useState/useMemo/useCallback

### 4. Структура файлов
- Страницы только в `/app`
- Компоненты в `/components`
- Утилиты в `/lib`
- Типы в `/types`
- Данные в `/data`

### 5. TypeScript
- Строгая типизация
- Использовать типы из `/types/map.ts`
- Избегать `any`
- Экспортировать типы для переиспользования

### 6. Telegram WebApp
- Всегда проверять наличие `window.Telegram?.WebApp`
- Использовать функции из `/lib/telegram.ts`
- Поддерживать работу как в Telegram, так и в обычном браузере

### 7. Производительность
- Использовать `useMemo` для тяжелых вычислений
- Debounce для поиска (300ms)
- Client components только когда необходимо

### 8. Добавление нового функционала

#### Новый раздел в JSON:
```json
{
  "id": "unique-id",
  "title": "Название",
  "description": "Описание",
  "order": 10
}
```

#### Новый материал в JSON:
```json
{
  "id": "unique-id",
  "sectionId": "existing-section-id",
  "title": "Название",
  "description": "Описание",
  "tags": ["tag1", "tag2"],
  "url": "https://...",
  "pinned": false
}
```

#### Новая страница:
1. Создать `app/your-page/page.tsx`
2. Добавить ссылку в `components/TabsNav.tsx` если нужно
3. Использовать существующие компоненты

#### Новый компонент:
1. Создать в `/components/YourComponent.tsx`
2. Экспортировать по умолчанию
3. Использовать TypeScript типы
4. Использовать Tailwind для стилей

### 9. Валидация
- Всегда запускать `npm run validate` после изменения `map.json`
- Проверять уникальность ID
- Проверять соответствие sectionId существующим разделам

### 10. Не делать
- ❌ Не добавлять базу данных
- ❌ Не использовать внешние API
- ❌ Не добавлять авторизацию
- ❌ Не использовать CSS-in-JS библиотеки
- ❌ Не создавать бэкенд
- ❌ Не добавлять тяжелые зависимости

### 11. Conventions
- Названия файлов: PascalCase для компонентов, camelCase для утилит
- Экспорт: default export для компонентов, named для утилит
- Комментарии: использовать JSDoc для сложной логики
- Форматирование: следовать .prettierrc если есть

### 12. Git workflow
- main ветка защищена
- Создавать feature branches для новых фич
- Коммиты: "feat:", "fix:", "docs:", "refactor:", "style:", "test:"
- После изменения map.json запускать validate

## Быстрые команды

```bash
npm run dev       # Разработка
npm run build     # Сборка
npm run validate  # Проверка данных
npm run lint      # Линтер
```

## Структура данных (map.json)

```typescript
interface MapData {
  meta: {
    title: string;
    version: string;
    updatedAt: string;
  };
  sections: Section[];
  items: Item[];
}
```

## Ключевые функции

- `lib/data.ts` - работа с данными
- `lib/search.ts` - поиск
- `lib/storage.ts` - localStorage
- `lib/telegram.ts` - Telegram WebApp API

## Приоритеты

1. **Простота** - не усложнять архитектуру
2. **Производительность** - быстрая загрузка
3. **Мобильность** - mobile-first
4. **Telegram** - корректная работа в Telegram
5. **Типизация** - строгий TypeScript

---

Следование этим правилам гарантирует консистентность и качество кода.

